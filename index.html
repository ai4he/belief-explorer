<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Belief Explorer</title>
  <style>
    /* Base styling */
    body {
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      max-width: 700px;
      margin: 0 auto;
      padding: 20px;
      background-color: #ffffff;
      color: #000000;
      line-height: 1.6;
    }
    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      body {
        background-color: #121212;
        color: #ffffff;
      }
      .chat-container, .input-area {
        background-color: #1e1e1e;
      }
      textarea {
        background-color: #2c2c2c;
        color: #ffffff;
        border: 1px solid #444;
      }
    }
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    .header h1 {
      margin: 0;
      font-size: 2em;
    }
    .header .description {
      font-style: italic;
      margin-top: 8px;
      color: #555;
    }
    .chat-container {
      background: inherit;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      min-height: 300px;
      max-height: 400px;
      overflow-y: auto;
      margin-bottom: 20px;
    }
    .message {
      margin: 10px 0;
      padding: 10px 14px;
      border-radius: 6px;
      max-width: 85%;
    }
    .assistant-message {
      background: #e0e0e0;
      color: #000;
      align-self: flex-start;
    }
    .user-message {
      background: #f5f5f5;
      color: #000;
      align-self: flex-end;
    }
    .input-area {
      display: flex;
      flex-direction: column;
      gap: 10px;
      background: inherit;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
      resize: none;
      box-sizing: border-box;
    }
    button {
      background-color: #000;
      color: #fff;
      font-size: 16px;
      border: none;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover:not(:disabled) {
      background-color: #333;
    }
    button:disabled {
      background-color: #888;
      cursor: not-allowed;
    }
    /* Spinner for "thinking" */
    .spinner {
      border: 4px solid rgba(0,0,0,0.1);
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border-left-color: #000;
      animation: spin 1s linear infinite;
      margin: 10px auto;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    /* Footer with disclaimer and project goals */
    .footer {
      margin-top: 30px;
      padding-top: 10px;
      border-top: 1px solid #ccc;
      font-size: 0.9em;
      text-align: center;
      color: #777;
    }
  </style>
</head>
<body>

  <div class="header">
    <h1>Belief Explorer</h1>
    <div class="description">
      Investigate your beliefs through meaningful AI dialogue.
    </div>
  </div>

  <div class="chat-container" id="chatContainer">
    <div class="message assistant-message">
      What belief or idea would you like to explore together?
    </div>
  </div>

  <div class="input-area">
    <textarea id="userInput" rows="3" placeholder="Share your thoughts..."></textarea>
    <button id="sendButton">Continue Dialogue</button>
    <div id="spinner" class="spinner" style="display: none;"></div>
  </div>

  <div class="footer">
    <p>Note: This alpha release does not save conversations.</p>
    <p>
      <strong>About Belief Explorer:</strong> Our platform is designed to build the first unbiased repository of human beliefsâ€”one that validates ideas based on factual alignment and observation rather than emotional bias. By helping individuals reflect on and critically examine their beliefs, we empower users to defend their ideas through evidence and reason.
    </p>
  </div>

  <script>
    const API_URL = 'https://gpu.haielab.org/webhook/deepseek-llama-demo';
    const chatContainer = document.getElementById('chatContainer');
    const userInput = document.getElementById('userInput');
    const sendButton = document.getElementById('sendButton');
    const spinner = document.getElementById('spinner');

    // Conversation history: initialize with the opening message.
    let conversationHistory = [
      { role: 'assistant', content: 'What belief or idea would you like to explore together?' }
    ];

    function renderConversation() {
      chatContainer.innerHTML = '';
      conversationHistory.forEach(turn => {
        const div = document.createElement('div');
        div.className = 'message ' + (turn.role === 'assistant' ? 'assistant-message' : 'user-message');
        div.textContent = turn.content;
        chatContainer.appendChild(div);
      });
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    renderConversation();

    async function handleSend() {
      const text = userInput.value.trim();
      if (!text) return;
      
      // Add user message to history and re-render
      conversationHistory.push({ role: 'user', content: text });
      renderConversation();
      
      // Clear input and show spinner
      userInput.value = '';
      userInput.disabled = true;
      sendButton.disabled = true;
      spinner.style.display = 'block';

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            statement: text,
            history: conversationHistory
          })
        });
        if (!response.ok) throw new Error(`Server error: ${response.status}`);
        const data = await response.json();
        const aiText = data.answer || "No answer returned.";
        conversationHistory.push({ role: 'assistant', content: aiText });
        renderConversation();
      } catch (err) {
        console.error(err);
        conversationHistory.push({ role: 'assistant', content: 'An error occurred. Please try again.' });
        renderConversation();
      } finally {
        spinner.style.display = 'none';
        userInput.disabled = false;
        sendButton.disabled = false;
        userInput.focus();
      }
    }

    sendButton.addEventListener('click', handleSend);
    userInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey && !userInput.disabled) {
        e.preventDefault();
        handleSend();
      }
    });
  </script>
</body>
</html>
